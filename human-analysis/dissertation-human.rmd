---
title: "dissertation-main-human"
author: "S2599932"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Analysis of human scRNA seq data generated using SMART-Seq2



```{r}
library(Seurat)
library(scMerge)
library(SingleCellExperiment)
library(ggplot2)
library(dplyr)
library(biomaRt)
library(corrplot)
library(biomaRt)
library(scater)
library(scran)
library(tidyverse)
```

> dataset one - GSE36552
> dataset two - E-MTAB-3929

```{r}
# Load in the dataset and targets file
dataset_one <- read.csv("./GSE36552_counts.csv", header = TRUE)

dataset_one <- dataset_one %>%
  column_to_rownames(var = colnames(dataset_one)[1]) %>%
  as.data.frame()
```

```{r}
dataset_two <- read.table("../data/data/E-MTAB-3929/counts.txt", row.names = 1)
```



```{r}
d1_targets <- read.csv("./GSE36552_targets_file.csv", sep = ",", header = TRUE)

d1_targets <- DataFrame(d1_targets)
```



```{r}
data("segList_ensemblGeneID", package = "scMerge")
hSEG <- segList_ensemblGeneID$human$human_scSEG
```



```{r}
# Use the Ensembl BioMart
ensembl <- useMart("ensembl")

# Choose the dataset for mouse genes
human_dataset <- useDataset("hsapiens_gene_ensembl", mart = ensembl)

# Perform the query to get the gene names
gene_mapping <- getBM(attributes = c("ensembl_gene_id", "external_gene_name"),
                      filters = "ensembl_gene_id",
                      values = hSEG,
                      mart = human_dataset)
```



```{r}
hSEG_names <- gene_mapping$external_gene_name
```



```{r not_completed_metadata, eval=FALSE}
### NEED TO MODIFY THE CODE

# Example metadata
cell_metadata <- data.frame(
    cell_id = colnames(counts),
    cell_type = rep(c("Type1", "Type2"), length.out = ncol(counts))
)
rownames(cell_metadata) <- cell_metadata$cell_id

# Adding metadata to the SingleCellExperiment object
colData(sce) <- DataFrame(cell_metadata)

```



```{r}
d1_sce <- SingleCellExperiment(assays = list(counts = as.matrix(dataset_one)))
colData(d1_sce) <- d1_targets
# d2_sce <- SingleCellExperiment(assays = list(counts = as.matrix(dataset_two)))
```



The `SingleCellExperiment` class in R is a specialized container for storing and manipulating single-cell genomics data. It extends the `SummarizedExperiment` class and is designed to accommodate the complexities and specific requirements of single-cell experiments.

Here is an explanation of the two `SingleCellExperiment` objects provided:

### Object 1

- **Class**: SingleCellExperiment
- **Dimensions**: 20410 genes (rows) Ã— 124 cells (columns)
- **Metadata**: None (`metadata(0)`)
- **Assays**: 1 assay, named `counts`
- **Row Names**: 20410 gene names, ranging from `A1BG` to `ZZEF1` and `ZZZ3`
- **Row Data**: No additional row data (`rowData names(0)`)
- **Column Names**: 124 cell names, ranging from `Sample_M21` to `Sample_G2`
- **Column Data**: No additional column data (`colData names(0)`)
- **Reduced Dimensions**: None (`reducedDimNames(0)`)
- **Main Experiment Name**: NULL
- **Alternative Experiment Names**: None (`altExpNames(0)`)

### Object 2

- **Class**: SingleCellExperiment
- **Dimensions**: 26178 genes (rows) Ã— 1529 cells (columns)
- **Metadata**: None (`metadata(0)`)
- **Assays**: 1 assay, named `counts`
- **Row Names**: 26178 gene names, ranging from `A1BG` to `ZZEF1` and `ZZZ3`
- **Row Data**: No additional row data (`rowData names(0)`)
- **Column Names**: 1529 cell names, ranging from `E5.5.101` to `E3.53.3438`
- **Column Data**: No additional column data (`colData names(0)`)
- **Reduced Dimensions**: None (`reducedDimNames(0)`)
- **Main Experiment Name**: NULL
- **Alternative Experiment Names**: None (`altExpNames(0)`)

### Key Components Explained

- **Class**: Indicates the object is a `SingleCellExperiment`, a specialized class for single-cell data.
- **Dimensions (dim)**: The number of genes (rows) and cells (columns) in the dataset.
- **Metadata**: General metadata associated with the experiment. In this case, there is no metadata.
- **Assays**: The primary data of the experiment, typically including counts or normalized expression values. Here, it includes one assay named `counts`.
- **Row Names (rownames)**: Names of genes included in the experiment.
- **Row Data (rowData names)**: Additional annotations or data related to the genes. None are included here.
- **Column Names (colnames)**: Names of individual cells in the dataset.
- **Column Data (colData names)**: Additional annotations or data related to the cells. None are included here.
- **Reduced Dimensions (reducedDimNames)**: Reduced dimensional representations of the data, such as PCA or t-SNE results. None are included here.
- **Main Experiment Name (mainExpName)**: A name for the primary experiment, if specified. It is NULL here.
- **Alternative Experiment Names (altExpNames)**: Names for alternative experiments or datasets included in the object. None are included here.

These objects are structured to allow for efficient storage, manipulation, and analysis of single-cell data, integrating various data types and annotations commonly used in single-cell genomics studies.

### HH

### d1_sce
```{r deconvolution_normalization, message=FALSE, warning=FALSE}
clusters <- quickCluster(d1_sce)
d1_sce <- computeSumFactors(d1_sce, clusters = clusters)
d1_sce <- logNormCounts(d1_sce)
```


```{r}
# Identify highly variable genes
dec <- modelGeneVar(d1_sce)
top_hvgs <- getTopHVGs(dec, n=2000)  # Select top 2000 highly variable genes
```

```{r}
is_subset <- all(hSEG_names %in% rownames(d1_sce))

# Print the result
if (is_subset) {
    print("The smaller vector is a subset of the larger vector.")
} else {
    print("The smaller vector is NOT a subset of the larger vector.")
}
```


```{r}
# Perform PCA
d1_sce <- runPCA(d1_sce, subset_row = intersect(hSEG_names, rownames(d1_sce)))
```

```{r fig.height=14, fig.width=14}
plotPCA(d1_sce, colour_by = "Cell_Type")
```





```{r}
clusters <- quickCluster(d2_sce)
d2_sce <- computeSumFactors(d2_sce, clusters = clusters)
d2_sce <- logNormCounts(d2_sce)
```



```{r}
dec <- modelGeneVar(d2_sce)
top_hvgs <- getTopHVGs(dec, n=2000)
```



```{r}
# Ensure hSEG_names are valid
valid_genes <- intersect(hSEG_names, rownames(d2_sce))

d2_sce <- runPCA(d2_sce, subset_row = valid_genes)

plotPCA(d2_sce)
```
















































































































































































































































